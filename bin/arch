#!/bin/sh

_version() {
	echo "$0 (coreutils-sh) devel"
	exit 0
}

_help() {
	echo "Usage: $0 [OPTION]..."
	echo "Print machine architecture."
	echo ""
	echo "      --help        display this help and exit"
	echo "      --version     output version information and exit"
	exit 0
}

_error() {
	>&2 echo "$*"
	>&2 echo "Try '$0 --help' for more information."
	exit 1
}

_get_arch() {
	if [ -r /proc/sys/kernel/arch ]; then
		read -r arch < /proc/sys/kernel/arch
	else
		while IFS="" read -r line; do
			case "$line" in
				*x86_64*|*amd64*)   arch=x86_64;;
				*i386*)             arch=i386;;
				*i486*)             arch=i486;;
				*i586*)             arch=i586;;
				*i686*)             arch=i686;;
				*aarch64*|*arm64*)  arch=aarch64;;
				*armv8l*)           arch=armv8l;;
				*armv7l*)           arch=armv7l;;
				*armv6l*)           arch=armv6l;;
				*ppc64le*)          arch=ppc64le;;
				*ppc64*)            arch=ppc64;;
				*ppc*)              arch=ppc;;
				*riscv64*)          arch=riscv64;;
				*riscv32*)          arch=riscv32;;
				*loongarch64*)      arch=loongarch64;;
				*)                  exit 1;;
			esac
		done < /proc/version
	fi
	if [ -n "$arch" ]; then
		echo "$arch"
		exit 0
	fi
	exit 1
}

while :; do case "$1" in
	--)         shift; break;;
	--help)     _help;;
	--version)  _version;;
	-*)         _error "$0: invalid option -- '$1'";;
	*)          break;;
	esac
done

if [ -n "$1" ]; then
	_error "$0: extra operand '$1'"
fi

_get_arch
